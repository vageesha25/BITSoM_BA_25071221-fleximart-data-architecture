import{s as de,y as A,v,a as P,r as b,I as B,f as N,h as C,k as n,P as q,S as j,j as l,w as u,M as L,$ as z,x as Q,q as g,g as _,t as O,o as d,H as W,e as U,L as K,aD as X,ao as ce,F as Y,af as ee,ak as te,G as me,Q as pe,bn as ve}from"./app-DzbCtFXP.js";import{d as Z}from"./objectUtil-Z6JRxuBJ.js";import{E as ye,u as fe}from"./dialogStore-D6Q9NWCo.js";import{c as _e,s as ge,p as ke,l as he}from"./common_view_utils-bnHHXSm9.js";import{E as le,a as ne}from"./index-oud-VZj9.js";import{E as be}from"./index-GP8RpTwj.js";import{E as we,a as xe}from"./index-BExd77YI.js";import{E as oe,a as Se}from"./index-DkA-wqnD.js";import{c as Ve,s as Ne}from"./codemirror-CGw-z8Wf.js";import"./isEqual-BdMtZB5P.js";import"./index-CAvTKiYZ.js";import"./index-B2LYU3pt.js";import"./index-B4FfeFwV.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-QnkWekc2.js";import"./castArray-DVv5FlX5.js";import"./merge-BN9r680A.js";import"./_initCloneObject-CUHH2U83.js";import"./isArrayLikeObject-Bf7ojnky.js";import"./index-ClCwDGTK.js";import"./clone-CX7ngrgR.js";import"./_baseClone-D07UiUvb.js";import"./_commonjsHelpers-CqkleIqs.js";import"./DatabaseType-BbdbLm9P.js";var ae=(a=>(a.NONE="none",a.STRING="string",a.REJSON="ReJSON-RL",a.HASH="hash",a.LIST="list",a.ZSET="zset",a.SET="set",a.STREAM="stream",a))(ae||{});const D=de("redis",{state:()=>({stack:!1,remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(a){if(a!=null&&(this.itemModel.value=a),!this.edit.name)return A("Key name cannot be null!");v.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),Ce={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},ze={key:1,class:"key-label key-detail-type"},Ee=P({__name:"RedisKeyInfo",setup(a){const i=b(!1),e=D(),{key:o,edit:c}=B(e),E=()=>{Q(z("confirm.deleteRedisKey")).then(()=>{v.emit("del",{key:{name:e.key.name}}),e.key={},e.edit={}})},$=()=>{v.emit("rename",{key:{name:e.key.name,newName:e.edit.name}})},w=()=>{v.emit("ttl",{key:{name:e.key.name,ttl:e.edit.ttl}})};return v.on("new",()=>{i.value=!0}),v.on("detail",()=>{i.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&c.value.ttl>0&&(c.value.ttl-=1)},1e3),(I,y)=>{const p=le,f=ne,m=q,S=L("vsc-button"),M=L("vsc-tooltip");return d(),N("div",Ce,[C("div",null,[n(m,{ref:"keyNameInput",modelValue:l(c).name,"onUpdate:modelValue":y[1]||(y[1]=k=>l(c).name=k),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:j($,["enter"])},{prepend:u(()=>[i.value?(d(),g(f,{key:0,modelValue:l(o).type,"onUpdate:modelValue":y[0]||(y[0]=k=>l(o).type=k),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:u(()=>[n(p,{value:"string",label:"STRING"}),l(e).stack?(d(),g(p,{key:0,value:"ReJSON-RL",label:"ReJSON-RL"})):_("",!0),n(p,{value:"list",label:"LIST"}),n(p,{value:"set",label:"SET"}),n(p,{value:"zset",label:"ZSET"}),n(p,{value:"hash",label:"HASH"}),n(p,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(d(),N("span",ze,O(l(o).type),1))]),_:1},8,["modelValue"]),n(M,{title:l(z)("result.copy"),placement:"top"},{default:u(()=>[n(S,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:y[2]||(y[2]=k=>l(_e)(l(c).name))})]),_:1},8,["title"])]),C("div",null,[n(m,{modelValue:l(c).ttl,"onUpdate:modelValue":y[3]||(y[3]=k=>l(c).ttl=k),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:j(w,["enter"])},{prepend:u(()=>y[4]||(y[4]=[C("span",{class:"key-label"},"TTL",-1)])),_:1},8,["modelValue"]),n(S,{icon:"codicon codicon-save",size:"mini",onClick:w}),n(S,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:E})])])}}}),$e=W(Ee,[["__scopeId","data-v-ae794ec1"]]),Ie={key:0},Re={id:"listPanel"},Le=["title","textContent"],Me=P({__name:"RedisListView",setup(a){const i=D(),{key:e,itemModel:o,remainHeight:c}=B(i),E=b(""),$=b(""),w=b(1),I=b(100),y=b(0),p=b(!1);v.on("detail",r=>{p.value=!1,w.value=r.page.pageNum,I.value=r.page.pageSize}).on("pagination",r=>{i.key.content=r}).on("success",()=>{p.value=!1});const f=U(()=>{const r=i.itemModel.old;let t=e.value.type;return t=t.charAt(0).toUpperCase()+t.slice(1),`${r?"Edit":"Add to"} ${t}`}),m=U(()=>{const r=e.value.type;switch(r){case"list":return"Element";case"hash":return"Value";case"set":case"zset":return"Member";case"stream":return"Entry";default:return r.charAt(0).toUpperCase()+r.slice(1)}}),S=(r,t)=>{v.emit("changePage",t?r:w.value+r)},M=()=>{p.value=!0,i.itemModel={old:null,key:null,index:null,score:null,value:null}},k=U(()=>{e.value.content||(e.value.content=[]);const r=E.value,t=$.value,V=e.value.content.filter(h=>!(r&&e.value.type=="hash"&&!`${h.key}`.match(new RegExp(r,"i"))||t&&!`${h.value??h}`.match(new RegExp(t,"i"))));return y.value=e.value.count??V.length,V}),J=r=>{Q(z("confirm.deleteRedisKey")).then(()=>{v.emit("deleteLine",r)})},F=r=>{navigator.clipboard.writeText(r.value??r),X(z("common.copied"))},x=r=>{i.itemModel={...r,old:{...r}},p.value=!0};return(r,t)=>{const V=q,h=L("vsc-button"),H=L("vsc-tooltip"),se=ye,T=Se,ie=oe,re=be,R=xe,ue=we;return["list","hash","set","zset","stream"].includes(l(e).type)?(d(),N("div",Ie,[C("div",Re,[l(e).type=="hash"?(d(),g(V,{key:0,modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=s=>E.value=s),class:"filter-input mb-2 mr-2",size:"small",style:{width:"120px"},placeholder:l(z)("result.searchField"),clearable:!0},null,8,["modelValue","placeholder"])):_("",!0),n(V,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),class:"filter-input mb-2",size:"small",style:{width:"200px"},placeholder:l(z)("result.searchNotice"),clearable:!0},null,8,["modelValue","placeholder"]),n(H,{title:l(z)("common.refresh"),placement:"top"},{default:u(()=>[n(h,{type:"icon",icon:"codicon-refresh text-lg",class:"ml-2",onClick:t[2]||(t[2]=s=>{l(v).emit("refresh")})})]),_:1},8,["title"]),n(H,{title:"Add new key"},{default:u(()=>[l(e).type!="stream"?(d(),g(h,{key:0,type:"icon",icon:"codicon-add text-lg",class:"inline-block !ml-1",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:t[3]||(t[3]=s=>M())})):_("",!0)]),_:1}),n(se,{"page-size":I.value,"onUpdate:pageSize":t[4]||(t[4]=s=>I.value=s),"current-page":w.value,"onUpdate:currentPage":t[5]||(t[5]=s=>w.value=s),small:!0,total:y.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:t[6]||(t[6]=s=>S(s,!0)),onNextClick:t[7]||(t[7]=()=>S(1)),onPrevClick:t[8]||(t[8]=()=>S(-1))},null,8,["page-size","current-page","total"]),n(re,{modelValue:p.value,"onUpdate:modelValue":t[15]||(t[15]=s=>p.value=s),"show-close":!1,title:f.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:"30%",class:"new-item-dialog"},{footer:u(()=>[n(h,{type:"secondary",onClick:t[13]||(t[13]=s=>p.value=!1)},{default:u(()=>[K(O(l(z)("common.cancel")),1)]),_:1}),n(h,{type:"primary",onClick:t[14]||(t[14]=s=>l(i).saveListItem())},{default:u(()=>t[16]||(t[16]=[K("Confirm")])),_:1})]),default:u(()=>[n(ie,{"label-width":"60px"},{default:u(()=>[l(e).type=="list"?(d(),g(T,{key:0,label:"Index"},{default:u(()=>[n(V,{modelValue:l(o).index,"onUpdate:modelValue":t[9]||(t[9]=s=>l(o).index=s),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),l(e).type=="hash"?(d(),g(T,{key:1,label:"Field"},{default:u(()=>[n(V,{modelValue:l(o).key,"onUpdate:modelValue":t[10]||(t[10]=s=>l(o).key=s),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),l(e).type=="zset"?(d(),g(T,{key:2,label:"Score"},{default:u(()=>[n(V,{modelValue:l(o).score,"onUpdate:modelValue":t[11]||(t[11]=s=>l(o).score=s),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),n(T,{label:m.value},{default:u(()=>[n(V,{modelValue:l(o).value,"onUpdate:modelValue":t[12]||(t[12]=s=>l(o).value=s),size:"small"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]),C("div",null,[n(ue,{data:k.value,height:l(c),border:""},{default:u(()=>[l(e).type=="list"?(d(),g(R,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),l(e).type=="hash"?(d(),g(R,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Field",align:"center",width:"200",prop:"key"})):_("",!0),l(e).type=="zset"?(d(),g(R,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),l(e).type=="stream"?(d(),g(R,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),n(R,{"sort-by":"value",resizable:"",sortable:"",label:m.value,align:"center"},{default:u(s=>[C("span",{class:"item-value",title:s.row.value,textContent:O(s.row?.value||s.row)},null,8,Le)]),_:1},8,["label"]),n(R,{label:"Operation",width:"150",align:"center"},{default:u(s=>[n(h,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:G=>{F(s.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(l(e).type)?(d(),g(h,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:G=>x(s.row)},null,8,["onClick"])):_("",!0),n(h,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:G=>J(s.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}});function Ue(a){if(a==null)return"";if(!Number.isFinite(a)&&(a=parseInt(a),!Number.isFinite(a)))return`${a}`;const i=a<0;i&&(a=-a);const e=["B","K","M","G","T","P","E","Z","Y"];if(a<1)return`${i?"-":""}${a} ${e[0]}`;const o=Math.min(Math.floor(Math.log(a)/Math.log(1024)),e.length-1);a=a/1024**o;const c=Number(a.toPrecision(3));return`${i?"-":""}${c}${e[o]}`}const Oe={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3 items-center ml-1"},Te={key:0,class:"flex"},Ke={class:"value-panel"},Pe=P({__name:"RedisStringView",setup(a){const i=D(),{key:e}=B(i),o=b(""),c=b("Text"),E=b(Ne),$=U(()=>Ue(o.value?.length||0)),w=U(()=>["string","ReJSON-RL"].includes(i.key.type));window.addEventListener("keydown",f=>{w.value&&ce(f)&&f.code=="KeyS"&&I()});const I=()=>{if(!i.edit.name)return A("Key name cannot be null!");v.emit("update",{key:{name:i.key.name,newName:i.edit.name,type:i.key.type,ttl:i.edit.ttl,content:o.value}})};v.on("detailNext",()=>{y()});const y=()=>{if(!w.value)return o.value="";const f=i.edit.content,m=f?.match(/^\s*[{[]/)!=null;c.value=m?"JSON":"Text",m?p(f):o.value=f},p=f=>{try{o.value=ge(ke(f?.replace?.(/Â /g," ")),null,2)}catch(m){console.error(m),o.value=f}};return(f,m)=>{const S=le,M=ne,k=L("vsc-button"),J=L("vsc-tooltip"),F=oe;return d(),N(Y,null,[["string","ReJSON-RL"].includes(l(e).type)?(d(),N("div",Oe,[C("div",null," Size: "+O($.value),1),["string","ReJSON-RL"].includes(l(e).type)?(d(),N("div",Te,[n(M,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=x=>c.value=x),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:u(()=>[(d(!0),N(Y,null,me(E.value,x=>(d(),g(S,{key:x,value:x},{default:u(()=>[K(O(x),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(J,{title:f.$t("common.refresh"),placement:"top"},{default:u(()=>[n(k,{type:"secondary",size:"micro",icon:"codicon-refresh",onClick:m[1]||(m[1]=x=>{l(v).emit("refresh")})})]),_:1},8,["title"]),n(k,{icon:"codicon codicon-save",style:{height:"27px"},onClick:I},{default:u(()=>m[3]||(m[3]=[K("Save")])),_:1})])):_("",!0)])):_("",!0),ee(n(F,null,{default:u(()=>[C("div",Ke,[n(Ve,{ref:"cmEditor",value:o.value,"onUpdate:value":m[2]||(m[2]=x=>o.value=x),language:c.value,class:"json-panel",style:pe("height:"+l(i).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[te,["string","ReJSON-RL"].includes(l(e).type)]])],64)}}}),De=W(Pe,[["__scopeId","data-v-1ea839f2"]]),Je={class:"redis-view-container"},Fe={key:0,style:{"text-align":"center"}},He={class:"mx-2"},vt=P({__name:"RedisView",setup(a){const i=b(!0),e=D();return fe(),ve(()=>{he(100,[],o=>{e.remainHeight=o}),v.on("new",({prefix:o,stack:c})=>{i.value=!1,e.stack=c,e.key={name:o,type:ae.STRING,ttl:-1},e.edit=Z(e.key)}).on("detail",o=>{i.value=!1,e.key=o.res,e.edit=Z(o.res),v.emitImmediately("detailNext")}).on("error",o=>{A(o)}).on("success",o=>{X(o)}),v.emit("init")}),(o,c)=>(d(),N("div",Je,[i.value?(d(),N("div",Fe," loading ")):_("",!0),ee(C("div",He,[n($e),n(Me),n(De)],512),[[te,!i.value]])]))}});export{vt as default};

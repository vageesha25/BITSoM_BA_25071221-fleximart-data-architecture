import{s as h,v as i,bs as a}from"./app-DzbCtFXP.js";import{D as l}from"./DatabaseType-BbdbLm9P.js";import{b as o}from"./wrapper-BXvM5gqA.js";import{a as c}from"./viewUtil-CTdDvppq.js";import{A as f}from"./arrayUtil-BBqtGZ24.js";const u=Symbol("isNew"),p=Symbol("index"),m=h("result",{state:()=>({data:[],backupData:[],isArrayResult:!1,fields:[],dbType:null,costTime:0,sql:"",transId:null,hasTruncate:!1,readonly:!1,reverseData:!1,columnList:null,columnTypeMap:null,database:null,table:null,withDot:null,tableCount:null,pageNum:null,pageSize:null}),getters:{noTable(e){return e.tableCount!=1},primaryKeyList(e){return[l.ES,l.MONGO_DB].includes(e.dbType)?[{name:"_id",type:"text"}]:e.columnList?.filter(t=>t.isPrimary)},hasPK(){return this.primaryKeyList?.length},isNoSQL(){return["ElasticSearch","MongoDB"].includes(this.dbType)},newData(){return this.data.filter(e=>e[u])}},actions:{onDataChange(e){this.backupData=f.clone(e);for(let t=0;t<e.length;t++)e[t][p]=t},getTypeByField(e){if(this.dbType==l.ES&&e.name=="_id")return"text";const t=this.columnTypeMap?.[e.name];if(t){const{type:r,originType:n,maximum_length:d}=t;if(c(r)&&d>65535)return n}return t?.type},clearNewData(){for(let e=this.data.length-1;e>0;e--)this.data[e][u]&&this.data.splice(e,1)}}});function x(e,t){return e?m().withDot?o(e,t):e.split(".").map(n=>o(n,t)).join("."):null}class g{constructor(){this.commands=[],this.index=0}push(t){this.commands.push(t),this.index=this.commands.length-1}previous(){if(this.commands.length!=0){if(this.index--<0){this.index=0;return}return this.commands[this.index]}}next(){if(this.commands.length!=0){if(this.index++>=this.commands.length){this.index=this.commands.length-1;return}return this.commands[this.index]}}}const s=m(),v=h("UI",{state:()=>({showSQLPanel:!1,history:new g,state:{...a},viewColumn:2,viewType:"Default",info:{sql:null,message:null,error:!1,errorSQL:null},tableStatus:{remainHeight:0,doNotClear:!1,loadingTimeout:null,rawColumnWidth:500},table:{search:"",loading:!1,start:new Date().getTime(),loadingTimer:null,widthItem:{},sort:{ascIndex:null,descIndex:null},sortKeys:[],filterKeys:{},expandKeys:[],selectedRows:[],selectedRowKeys:[]},page:{pageNum:1,pageSize:-1,total:0},aggregate:{sum:0,avg:0,min:0,max:0,count:0},dialog:{importVisible:!1,exportVisible:!1,detailScope:null,detailVisible:!1},toolbar:{sql:null,saveLoading:!1,filter:{},showColumns:[]},deleteConfirm:{sql:"",visible:!1,skipForeignCheck:!1},monitorStatus:{dashBoard:!1,processList:!1,variableList:!1,statusList:!1,hasAnyMonitor:!1}}),getters:{hasResult(){return s.fields?.length>0},notAllowUpdate(){return s.tableCount!=1||s.readonly||!this.hasResult},notAllowUpdateLevel2(){return this.notAllowUpdate||this.reverseData},isSplitView(){return this.viewColumn>=2},reverseData(){return this.viewType=="Reverse"}},actions:{checkShowSQLPanel(){if(this.isSplitView&&([l.ES].includes(s.dbType)||window.innerHeight<500||this.toolbar?.sql?.match(/\n/g)?.length>1))return this.showSQLPanel=!1;this.showSQLPanel=!0},resetConfig(){this.viewType="Default";for(const e of Object.keys(a))this.state[e]=a[e],i.emit("upState",{key:e,value:a[e],ignore:!0});document.querySelector(".codemirror-container").style.height="40px"},closeConfig(){i.emitImmediately("closeConfig")},refresh(){this.execute(s.sql)},execute(e,t={}){e&&(i.emit("executeSQL",{sql:e,...t}),this.table.start=new Date().getTime(),this.queueLoading())},queueLoading(){this.tableStatus.doNotClear||(this.info.message=null),clearTimeout(this.tableStatus.loadingTimeout),this.tableStatus.loadingTimeout=setTimeout(()=>{this.table.loading=!0,s.costTime=0,clearInterval(this.table.loadingTimer),this.table.loadingTimer=setInterval(()=>{s.costTime=new Date().getTime()-this.table.start},79)},100)},upState(e,t=this.state[e]){i.emit("upState",{key:e,value:t})}}});export{m as a,u as b,p as i,v as u,x as w};

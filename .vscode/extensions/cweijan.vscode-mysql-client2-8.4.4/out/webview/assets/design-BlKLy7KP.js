import{r as B,J as ee,as as sl,a as se,at as il,au as rl,a4 as Ee,w as a,af as P,k as l,ak as Z,av as ul,aw as xe,ax as dl,ad as Ye,ay as Xe,az as ye,aA as He,aB as je,N as cl,aC as ml,s as pl,I as ge,e as F,O as ce,v as $,f as k,h as w,g as L,M as K,j as o,$ as d,q as D,L as O,t as x,F as J,G as ae,o as m,x as Ue,Q as bl,aD as We,P as Ne,S as Ce,y as Oe,H as Ze,R as Je,n as ze}from"./app-DzbCtFXP.js";import{D as R,a as fl}from"./DatabaseType-BbdbLm9P.js";import{b as Se}from"./viewUtil-CTdDvppq.js";import{c as ve}from"./codemirror-CGw-z8Wf.js";import{E as Ae}from"./index-GP8RpTwj.js";import{E as Ie,a as we}from"./index-BExd77YI.js";import{E as el}from"./index-ClCwDGTK.js";import{E as Le,a as De}from"./index-DkA-wqnD.js";import{a as Me,E as Be}from"./index-oud-VZj9.js";import{A as Ge}from"./arrayUtil-BBqtGZ24.js";import{E as gl}from"./index-CUEiWVIM.js";import{g as vl}from"./getDialect-CZLjIdHM.js";import{b as ue,E as _l,c as _e,g as Te}from"./wrapper-BXvM5gqA.js";import{S as de}from"./stringBuilder-DUZQE8vS.js";import{l as Tl}from"./common_view_utils-bnHHXSm9.js";import"./_commonjsHelpers-CqkleIqs.js";import"./index-CAvTKiYZ.js";import"./_baseIteratee-QnkWekc2.js";import"./isEqual-BdMtZB5P.js";import"./merge-BN9r680A.js";import"./_initCloneObject-CUHH2U83.js";import"./isArrayLikeObject-Bf7ojnky.js";import"./castArray-DVv5FlX5.js";import"./clone-CX7ngrgR.js";import"./_baseClone-D07UiUvb.js";import"./index-B2LYU3pt.js";import"./index-B4FfeFwV.js";import"./_baseFindIndex-D7XfJLKM.js";import"./objectUtil-Z6JRxuBJ.js";function hl(s){let e;const t=B(!1),n=ee({...s,originalPosition:"",originalOverflow:"",visible:!1});function i(f){n.text=f}function u(){const f=n.parent,T=A.ns;if(!f.vLoadingAddClassList){let I=f.getAttribute("loading-number");I=Number.parseInt(I)-1,I?f.setAttribute("loading-number",I.toString()):(xe(f,T.bm("parent","relative")),f.removeAttribute("loading-number")),xe(f,T.bm("parent","hidden"))}r(),_.unmount()}function r(){var f,T;(T=(f=A.$el)==null?void 0:f.parentNode)==null||T.removeChild(A.$el)}function g(){var f;s.beforeClose&&!s.beforeClose()||(t.value=!0,clearTimeout(e),e=window.setTimeout(c,400),n.visible=!1,(f=s.closed)==null||f.call(s))}function c(){if(!t.value)return;const f=n.parent;t.value=!1,f.vLoadingAddClassList=void 0,u()}const E=se({name:"ElLoading",setup(f,{expose:T}){const{ns:I,zIndex:p}=rl("loading");return T({ns:I,zIndex:p}),()=>{const v=n.spinner||n.svg,U=Ee("svg",{class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"0 0 50 50",...v?{innerHTML:v}:{}},[Ee("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),S=n.text?Ee("p",{class:I.b("text")},[n.text]):void 0;return Ee(ul,{name:I.b("fade"),onAfterLeave:c},{default:a(()=>[P(l("div",{style:{backgroundColor:n.background||""},class:[I.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[Ee("div",{class:I.b("spinner")},[U,S])]),[[Z,n.visible]])])})}}}),_=sl(E),A=_.mount(document.createElement("div"));return{...il(n),setText:i,removeElLoadingChild:r,close:g,handleAfterLeave:c,vm:A,get $el(){return A.$el}}}let Re;const El=function(s={}){if(!dl)return;const e=yl(s);if(e.fullscreen&&Re)return Re;const t=hl({...e,closed:()=>{var i;(i=e.closed)==null||i.call(e),e.fullscreen&&(Re=void 0)}});Cl(e,e.parent,t),qe(e,e.parent,t),e.parent.vLoadingAddClassList=()=>qe(e,e.parent,t);let n=e.parent.getAttribute("loading-number");return n?n=`${Number.parseInt(n)+1}`:n="1",e.parent.setAttribute("loading-number",n),e.parent.appendChild(t.$el),Ye(()=>t.visible.value=e.visible),e.fullscreen&&(Re=t),t},yl=s=>{var e,t,n,i;let u;return Xe(s.target)?u=(e=document.querySelector(s.target))!=null?e:document.body:u=s.target||document.body,{parent:u===document.body||s.body?document.body:u,background:s.background||"",svg:s.svg||"",svgViewBox:s.svgViewBox||"",spinner:s.spinner||!1,text:s.text||"",fullscreen:u===document.body&&((t=s.fullscreen)!=null?t:!0),lock:(n=s.lock)!=null?n:!1,customClass:s.customClass||"",visible:(i=s.visible)!=null?i:!0,target:u}},Cl=async(s,e,t)=>{const{nextZIndex:n}=t.vm.zIndex||t.vm._.exposed.zIndex,i={};if(s.fullscreen)t.originalPosition.value=ye(document.body,"position"),t.originalOverflow.value=ye(document.body,"overflow"),i.zIndex=n();else if(s.parent===document.body){t.originalPosition.value=ye(document.body,"position"),await Ye();for(const u of["top","left"]){const r=u==="top"?"scrollTop":"scrollLeft";i[u]=`${s.target.getBoundingClientRect()[u]+document.body[r]+document.documentElement[r]-Number.parseInt(ye(document.body,`margin-${u}`),10)}px`}for(const u of["height","width"])i[u]=`${s.target.getBoundingClientRect()[u]}px`}else t.originalPosition.value=ye(e,"position");for(const[u,r]of Object.entries(i))t.$el.style[u]=r},qe=(s,e,t)=>{const n=t.vm.ns||t.vm._.exposed.ns;["absolute","fixed","sticky"].includes(t.originalPosition.value)?xe(e,n.bm("parent","relative")):He(e,n.bm("parent","relative")),s.fullscreen&&s.lock?He(e,n.bm("parent","hidden")):xe(e,n.bm("parent","hidden"))},ke=Symbol("ElLoading"),Qe=(s,e)=>{var t,n,i,u;const r=e.instance,g=f=>je(e.value)?e.value[f]:void 0,c=f=>{const T=Xe(f)&&r?.[f]||f;return T&&B(T)},E=f=>c(g(f)||s.getAttribute(`element-loading-${ml(f)}`)),_=(t=g("fullscreen"))!=null?t:e.modifiers.fullscreen,A={text:E("text"),svg:E("svg"),svgViewBox:E("svgViewBox"),spinner:E("spinner"),background:E("background"),customClass:E("customClass"),fullscreen:_,target:(n=g("target"))!=null?n:_?void 0:s,body:(i=g("body"))!=null?i:e.modifiers.body,lock:(u=g("lock"))!=null?u:e.modifiers.lock};s[ke]={options:A,instance:El(A)}},Nl=(s,e)=>{for(const t of Object.keys(e))cl(e[t])&&(e[t].value=s[t])},he={mounted(s,e){e.value&&Qe(s,e)},updated(s,e){const t=s[ke];e.oldValue!==e.value&&(e.value&&!e.oldValue?Qe(s,e):e.value&&e.oldValue?je(e.value)&&Nl(e.value,t.options):t?.instance.close())},unmounted(s){var e;(e=s[ke])==null||e.instance.close(),s[ke]=null}},me=pl("design",{state:()=>({schema:"",table:"",columns:[],tableMeta:{},dbType:R.MYSQL,dialect:null,remainHeight:0,activePanel:"column"}),getters:{canAlterTable(s){try{return s.dialect?.updateColumn({oldRow:{}})!=null}catch(e){return console.error("canAlterTable",e),!0}},supportForeignKey(s){return s.dialect?.showForeignKeys()},supportCheck(s){return s.dialect?.showChecks()},supportTrigger(s){return s.dialect?.showTriggers()},supportIndex(s){return s.dialect?.showIndex()&&![R.SNOWFLAKE,R.DATABRICKS,R.ATHENA,R.BIG_QUERY,R.PRESTO,R.TRINO].includes(s.dbType)}},actions:{updateDBType(s){this.dbType=s},updateFullInfo(s){for(const e in s)this[e]=s[e]}}}),Al={class:"design-toolbar"},Il={class:"text-center"},wl=se({__name:"IndexPanel",setup(s){const e=B([]),t=B([]),n=B(!0),i=me(),{dbType:u,dialect:r,remainHeight:g,activePanel:c}=ge(i),E={visible:!1,loading:!1,column:null,columns:null,type:"INDEX"},_=ee({...E}),A=F(()=>_.columns?.length>0?r.value.newIndex({..._}):"");ce(()=>{$.on("designMetaNext",()=>{_.visible=!1,t.value=r.value.indexTypes(),f()}).on("indexes",U=>{e.value=U,n.value=!1}).on("success",U=>{U=="index"&&(_.loading=!1,_.visible=!1,f())}).on("error",()=>{_.loading=!1})});const f=()=>{$.emit("indexes"),n.value=!0},T=()=>{Object.assign(_,E),_.visible=!0,_.loading=!1},I=U=>r.value.formatIndexType(U),p=()=>{_.loading=!0,$.emit("execute",{type:"index",sql:A.value})},v=U=>{Ue(d("design.deleteIndexConfirm")).then(()=>{$.emit("execute",{type:"index",sql:r.value.dropIndex(U.index_name)})})};return(U,S)=>{const z=K("vsc-button"),V=K("vsc-tooltip"),y=we,G=el,Y=Ie,q=K("RedMark"),Q=Be,te=Me,H=De,X=Le,ne=Ae,be=he;return m(),k("div",null,[w("div",Al,[l(V,{title:o(d)("common.new")},{default:a(()=>[["ClickHouse"].includes(o(u))?L("",!0):(m(),D(z,{key:0,type:"icon",icon:"codicon-add text-base",onClick:T}))]),_:1},8,["title"]),l(V,{title:o(d)("common.refresh")},{default:a(()=>[l(z,{type:"icon",icon:"codicon-refresh text-base",onClick:f})]),_:1},8,["title"])]),o(c)=="index"?P((m(),D(Y,{key:0,data:e.value,height:o(g),border:""},{default:a(()=>[l(y,{resizable:!0,align:"center",prop:"index_name",label:o(d)("design.indexName"),width:"200"},null,8,["label"]),l(y,{resizable:!0,align:"center",prop:"column_name",label:o(d)("design.column"),width:"200"},null,8,["label"]),l(y,{align:"center",prop:"isUnique",label:o(d)("design.unique"),width:"200"},{default:a(({row:M})=>[l(G,{disabled:"","model-value":o(Se)(M.isUnique)},null,8,["model-value"])]),_:1},8,["label"]),l(y,{resizable:!0,align:"center",prop:"index_type",label:o(d)("common.type"),width:"200"},{default:a(({row:M})=>[O(x(I(M)),1)]),_:1},8,["label"]),o(fl)(o(u))?(m(),D(y,{key:0,resizable:!0,align:"center",prop:"index_method",label:o(d)("design.indexMethod"),width:"200"},null,8,["label"])):L("",!0),["ClickHouse"].includes(o(u))?L("",!0):(m(),D(y,{key:1,label:o(d)("design.operation"),width:"120"},{default:a(({row:M})=>[w("div",Il,[l(z,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:pe=>v(M)},null,8,["onClick"])])]),_:1},8,["label"]))]),_:1},8,["data","height"])),[[be,n.value]]):L("",!0),l(ne,{modelValue:_.visible,"onUpdate:modelValue":S[3]||(S[3]=M=>_.visible=M),"show-close":!1,title:o(d)("design.newIndex"),width:"520px",closeOnClickModal:!1,center:""},{footer:a(()=>[l(z,{type:"secondary",onClick:S[2]||(S[2]=M=>_.visible=!1)},{default:a(()=>[O(x(o(d)("common.cancel")),1)]),_:1}),l(z,{type:"primary",loading:_.loading,onClick:p},{default:a(()=>[O(x(o(d)("common.ok")),1)]),_:1},8,["loading"]),S[4]||(S[4]=w("br",null,null,-1)),S[5]||(S[5]=O()),S[6]||(S[6]=w("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:A.value,readonly:!0},null,8,["value"]),[[Z,A.value]])]),default:a(()=>[l(X,{inline:!0,"label-width":"75px",size:"small"},{default:a(()=>[l(H,null,{label:a(()=>[l(q),O(x(o(d)("design.column")),1)]),default:a(()=>[l(te,{modelValue:_.columns,"onUpdate:modelValue":S[0]||(S[0]=M=>_.columns=M),size:"small",filterable:"",multiple:"",class:"!w-[150px]"},{default:a(()=>[(m(!0),k(J,null,ae(o(i).columns,M=>(m(),D(Q,{key:M.name,label:M.name,value:M.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(H,null,{label:a(()=>[l(q),O(x(o(d)("common.type")),1)]),default:a(()=>[l(te,{modelValue:_.type,"onUpdate:modelValue":S[1]||(S[1]=M=>_.type=M),size:"small",class:"!w-[110px]"},{default:a(()=>[(m(!0),k(J,null,ae(t.value,(M,pe)=>(m(),D(Q,{key:pe,label:M.label,value:M.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),Ll={ref:"infoPanel",class:"design-toolbar"},Dl=se({__name:"DDL",setup(s){const e=me(),t=B(!1),n=B("");ce(()=>{$.on("designMetaNext",()=>{$.emit("ddl")}).on("ddl",({ddl:u})=>{t.value=!1,n.value=u})});const i=()=>{navigator.clipboard.writeText(n.value),We("Copy DDL success!")};return(u,r)=>{const g=K("vsc-button"),c=K("vsc-tooltip"),E=he;return P((m(),k("div",null,[w("div",Ll,[l(c,{title:"Copy DDL"},{default:a(()=>[l(g,{type:"icon",icon:"el-icon-document-copy text-base",onClick:i})]),_:1}),l(c,{title:u.$t("common.refresh")},{default:a(()=>[l(g,{type:"icon",icon:"codicon-refresh text-base",onClick:r[0]||(r[0]=_=>o($).emit("ddl"))})]),_:1},8,["title"])],512),o(e).activePanel=="ddl"?(m(),D(ve,{key:0,dbType:o(e).dbType,value:n.value,readonly:!0,style:bl({maxHeight:o(e).remainHeight+"px",overflow:"auto"}),class:"large"},null,8,["dbType","value","style"])):L("",!0)])),[[E,t.value]])}}}),$l={key:0,class:"design-toolbar"},Rl={class:"text-center"},kl=se({__name:"ForeignKey",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:i,activePanel:u}=ge(e),r=B([]),g=B([]),c=B([]),E=B([]),_=B(!0),A=ee({visible:!1,loading:!1}),f={column:null,refTable:null,refColumn:null,foreignKeyName:null,onUpdate:"NO ACTION",onDelete:"NO ACTION"},T=ee({...f}),I=F(()=>{const{column:V,refTable:y,refColumn:G}=T;return V||y||G?t.value.newForeignKey(T):""});ce(()=>{$.on("designMetaNext",()=>{A.visible=!1,E.value=t.value.strategies(),v(),$.emit("tables")}).on("foreignKeys",V=>{_.value=!1,r.value=V}).on("columnsById",V=>{T.refColumn="",c.value=V}).on("success",V=>{V=="fk"&&(A.loading=!1,A.visible=!1,v())}).on("error",()=>{A.loading=!1}).on("tables",V=>{g.value=V})});const p=V=>{$.emit("columnsById",V)},v=()=>{const V=t.value.showForeignKeys();V&&(_.value=!0,$.emit("foreignKeys",V))},U=()=>{Object.assign(T,f),A.visible=!0,A.loading=!1},S=()=>{A.loading=!0,$.emit("execute",{type:"fk",sql:I.value})},z=V=>{Ue(d("design.deleteFkConfirm")).then(()=>{$.emit("execute",{type:"fk",sql:t.value.dropForeignKey(V.constraint_name)})})};return(V,y)=>{const G=K("vsc-button"),Y=K("vsc-tooltip"),q=we,Q=Ie,te=K("RedMark"),H=Be,X=Me,ne=De,be=Ne,M=Le,pe=Ae,Ve=he;return m(),k("div",null,[o(n)?(m(),k("div",$l,[l(Y,{title:o(d)("common.new")},{default:a(()=>[l(G,{type:"icon",icon:"codicon-add text-base",onClick:U})]),_:1},8,["title"]),l(Y,{title:o(d)("common.refresh")},{default:a(()=>[l(G,{type:"icon",icon:"codicon-refresh text-base",onClick:v})]),_:1},8,["title"])])):L("",!0),o(u)=="foreignKey"?P((m(),D(Q,{key:1,data:r.value,style:{width:"100%"},height:o(i),border:""},{default:a(()=>[o(n)?(m(),D(q,{key:0,resizable:!0,align:"center",prop:"constraint_name",label:o(d)("design.constraintName"),width:"150"},null,8,["label"])):L("",!0),l(q,{resizable:!0,align:"center",prop:"column_name",label:o(d)("design.column"),width:"150"},null,8,["label"]),l(q,{resizable:!0,align:"center",prop:"referenced_table",label:o(d)("design.referencedTable"),width:"150"},null,8,["label"]),l(q,{resizable:!0,align:"center",prop:"referenced_column",label:o(d)("design.referencedColumn"),width:"155"},null,8,["label"]),l(q,{align:"center",prop:"updateRule",label:o(d)("design.updateRule"),width:"150"},null,8,["label"]),l(q,{align:"center",prop:"deleteRule",label:o(d)("design.deleteRule"),width:"150"},null,8,["label"]),o(n)?(m(),D(q,{key:1,label:o(d)("design.operation"),width:"120"},{default:a(({row:C})=>[w("div",Rl,[l(G,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:N=>z(C)},null,8,["onClick"])])]),_:1},8,["label"])):L("",!0)]),_:1},8,["data","height"])),[[Ve,_.value]]):L("",!0),l(pe,{modelValue:A.visible,"onUpdate:modelValue":y[7]||(y[7]=C=>A.visible=C),"show-close":!1,title:o(d)("design.newForeignKey"),width:"780px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(G,{type:"secondary",onClick:y[6]||(y[6]=C=>A.visible=!1)},{default:a(()=>[O(x(o(d)("common.cancel")),1)]),_:1}),l(G,{type:"primary",loading:A.loading,onClick:S},{default:a(()=>[O(x(o(d)("common.ok")),1)]),_:1},8,["loading"]),y[9]||(y[9]=w("br",null,null,-1)),y[10]||(y[10]=O()),y[11]||(y[11]=w("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:I.value,readonly:!0},null,8,["value"]),[[Z,I.value]])]),default:a(()=>[l(M,{inline:!0,"label-width":"150px","label-position":"left",size:"small"},{default:a(()=>[l(ne,null,{label:a(()=>[l(te),O(x(o(d)("design.column")),1)]),default:a(()=>[l(X,{modelValue:T.column,"onUpdate:modelValue":y[0]||(y[0]=C=>T.column=C),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),k(J,null,ae(o(e).columns,C=>(m(),D(H,{key:C.name,label:C.name,value:C.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,null,{label:a(()=>[O(x(o(d)("design.constraintName")),1)]),default:a(()=>[l(be,{modelValue:T.foreignKeyName,"onUpdate:modelValue":y[1]||(y[1]=C=>T.foreignKeyName=C),class:"!w-[170px]"},null,8,["modelValue"])]),_:1}),y[8]||(y[8]=w("br",null,null,-1)),l(ne,null,{label:a(()=>[l(te),O(x(o(d)("design.referencedTable")),1)]),default:a(()=>[l(X,{modelValue:T.refTable,"onUpdate:modelValue":y[2]||(y[2]=C=>T.refTable=C),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),k(J,null,ae(g.value,C=>(m(),D(H,{key:C.name,label:C.name,value:C.name,onClick:N=>p(C.id)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,null,{label:a(()=>[l(te),O(x(o(d)("design.referencedColumn")),1)]),default:a(()=>[l(X,{modelValue:T.refColumn,"onUpdate:modelValue":y[3]||(y[3]=C=>T.refColumn=C),size:"small",filterable:"",class:"!w-[170px]"},{default:a(()=>[(m(!0),k(J,null,ae(c.value,C=>(m(),D(H,{key:C.name,label:C.name,value:C.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,{label:"On Update"},{default:a(()=>[l(X,{modelValue:T.onUpdate,"onUpdate:modelValue":y[4]||(y[4]=C=>T.onUpdate=C),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),k(J,null,ae(E.value,C=>(m(),D(H,{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,{label:"On Delete"},{default:a(()=>[l(X,{modelValue:T.onDelete,"onUpdate:modelValue":y[5]||(y[5]=C=>T.onDelete=C),size:"small",filterable:"",class:"!w-[170px]"},{default:a(()=>[(m(!0),k(J,null,ae(E.value,C=>(m(),D(H,{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),xl={key:0,ref:"infoPanel",class:"design-toolbar"},Ol=["title"],Ul={class:"text-center"},Vl={class:"max-h-[300px] overflow-y-auto"},Sl=["onClick"],Ml=se({__name:"ColumnPanel",setup(s){const e=me(),{dbType:t,columns:n,dialect:i,canAlterTable:u,remainHeight:r,activePanel:g}=ge(e),c=ee({visible:!1,inputting:!1}),E=F(()=>i.value.columnTypes()),_=B([]),A=B(!1),f=B(!0),T=B([]),I={name:"",type:"",unsigned:null,zerofill:null,comment:null,isNotNull:null,defaultValue:null,useCurrentTimestamp:null},p=ee({...I}),v=ee({isNew:!0,editDisable:!1,editVisible:!1,editLoading:!1}),U=F(()=>V.value&&p.type?.match?.(/(\bint|decimal|float|double)/i)),S=F(()=>V.value&&p.type?.match?.(/timestamp/i)),z=F(()=>window.innerWidth<=1200),V=F(()=>["MySQL","Doris","MariaDB"].includes(t.value)),y=F(()=>{const N=v.isNew?"design.newColumn":"design.updateColumn";return d(N)}),G=F(()=>c.inputting&&p.type?E.value.filter(N=>(N.label||N).match(new RegExp(p.type,"i"))):E.value),Y=F(()=>{if(v.isNew){const{name:N,type:h}=p;return N&&h?i.value.newColumn(p):""}U.value||(p.zerofill=!1,p.unsigned=!1),S.value||(p.useCurrentTimestamp=!1);try{return i.value.updateColumn({newColumnName:p.name,columnType:p.type,nullable:!p.isNotNull,...p})}catch(N){return console.error(N),v.editDisable=!0,N}}),q=F(()=>[R.MYSQL,R.MARIA_DB,R.PG,R.DB2].includes(t.value));ce(()=>{$.on("designMetaNext",N=>{T.value=Ge.clone(N.columns),v.editVisible=!1,f.value=!1}).on("columns",N=>{T.value=Ge.clone(N),f.value=!1}).on("indexes",N=>{A.value=!0,_.value=N.filter(h=>Se(h.isUnique)).map(h=>h.column_name)}).on("success",N=>{N=="column"&&(v.editLoading=!1,v.editVisible=!1,X())}).on("error",()=>{v.editLoading=!1,X()})});const Q=(...N)=>!N.includes(t.value),te=N=>{N&&(p.defaultValue="CURRENT_TIMESTAMP")},H=()=>{const N=G.value[0];N&&(p.type=N.value||N,c.visible=!1)},X=()=>{$.emit("columns"),f.value=!0},ne=()=>{Object.assign(p,I),v.isNew=!0,v.editVisible=!0},be=N=>{Object.assign(p,{...N,columnName:N.name,oldRow:N}),v.isNew=!1,v.editVisible=!0,v.editDisable=!1,v.editLoading=!1},M=(N,h)=>{v.isNew=!1,Object.assign(p,{...N,columnName:N.name,oldRow:T.value[h]}),pe()},pe=()=>{if(!Y.value)return Oe("No any change!");if(v.editLoading=!0,v.isNew)return Ve();try{$.emit("execute",{type:"column",sql:Y.value})}catch(N){Oe(N.message),v.editLoading=!1}},Ve=()=>{$.emit("execute",{type:"column",sql:Y.value})},C=N=>{Ue(d("design.deleteColumnConfirm")).then(()=>{$.emit("execute",{type:"column",sql:i.value.dropColumn(N.name)})})};return(N,h)=>{const fe=K("vsc-button"),Pe=K("vsc-tooltip"),j=we,oe=el,ll=Ie,Ke=K("RedMark"),$e=Ne,re=De,tl=gl,nl=Le,ol=Ae,al=he;return m(),k("div",null,[o(u)?(m(),k("div",xl,[l(Pe,{title:o(d)("common.new")},{default:a(()=>[l(fe,{type:"icon",icon:"codicon-add text-base",onClick:ne})]),_:1},8,["title"]),l(Pe,{title:o(d)("common.refresh")},{default:a(()=>[l(fe,{type:"icon",icon:"codicon-refresh text-base",onClick:X})]),_:1},8,["title"])],512)):L("",!0),o(g)=="column"?P((m(),D(ll,{key:1,data:o(n),height:o(r),border:"",onRowDblclick:be},{default:a(()=>[l(j,{resizable:!0,align:"center",prop:"name",label:o(d)("common.name"),width:"180"},null,8,["label"]),l(j,{resizable:!0,align:"center",prop:"type",label:o(d)("common.type"),width:z.value?100:130},null,8,["label","width"]),l(j,{resizable:!0,align:"center",prop:"maximum_length",width:80,label:o(d)("design.length")},null,8,["label"]),["DuckDB"].includes(o(t))?L("",!0):(m(),D(j,{key:0,resizable:!0,align:"center",prop:"comment",label:o(d)("common.comment"),width:"100"},{default:a(({row:b})=>[w("span",{title:b?.comment},x(b?.comment),9,Ol)]),_:1},8,["label"])),l(j,{resizable:!0,align:"center",prop:"defaultValue",width:z.value?75:110,label:o(d)("common.default")},null,8,["width","label"]),l(j,{align:"center",label:"Not Null",width:80},{default:a(({row:b,$index:le})=>[l(oe,{modelValue:b.isNotNull,"onUpdate:modelValue":W=>b.isNotNull=W,onChange:W=>M(b,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(j,{align:"center",label:o(d)("design.isPrimary"),width:110},{default:a(({row:b})=>[l(oe,{disabled:"","model-value":b.isPrimary},null,8,["model-value"])]),_:1},8,["label"]),A.value||["MySQL","MariaDB","Doris"].includes(o(t))?(m(),D(j,{key:1,align:"center",label:o(d)("design.isUnique"),width:80},{default:a(({row:b})=>[l(oe,{disabled:"","model-value":b.isUnique||_.value.includes(b.name)},null,8,["model-value"])]),_:1},8,["label"])):L("",!0),["DuckDB"].includes(o(t))?L("",!0):(m(),D(j,{key:2,align:"center",label:o(d)("design.isAutoIncrement"),width:"130"},{default:a(({row:b,$index:le})=>[l(oe,{modelValue:b.isAutoIncrement,"onUpdate:modelValue":W=>b.isAutoIncrement=W,disabled:!b.isPrimary||!q.value,onChange:W=>M(b,le)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"])),["SQLite"].includes(o(t))?L("",!0):(m(),D(j,{key:3,label:o(d)("design.operation"),width:"100"},{default:a(({row:b})=>[w("div",Ul,[l(fe,{type:"icon",icon:"codicon-edit",title:"edit",onClick:le=>be(b)},null,8,["onClick"]),l(fe,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:le=>C(b)},null,8,["onClick"])])]),_:1},8,["label"])),V.value?(m(),k(J,{key:4},[l(j,{align:"center",label:"UNSIGNED",width:"100"},{default:a(({row:b,$index:le})=>[l(oe,{modelValue:b.unsigned,"onUpdate:modelValue":W=>b.unsigned=W,"true-value":"1","false-value":"0",onChange:W=>M(b,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(j,{align:"center",label:"Zerofill",width:"80"},{default:a(({row:b,$index:le})=>[l(oe,{modelValue:b.zerofill,"onUpdate:modelValue":W=>b.zerofill=W,"true-value":"1","false-value":"0",onChange:W=>M(b,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})],64)):L("",!0)]),_:1},8,["data","height"])),[[al,f.value]]):L("",!0),l(ol,{modelValue:v.editVisible,"onUpdate:modelValue":h[12]||(h[12]=b=>v.editVisible=b),"show-close":!1,title:y.value,width:"680px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(fe,{type:"secondary",onClick:h[11]||(h[11]=b=>v.editVisible=!1)},{default:a(()=>[O(x(o(d)("common.cancel")),1)]),_:1}),l(fe,{type:"primary",loading:v.editLoading,disabled:v.editDisable,onClick:pe},{default:a(()=>[O(x(o(d)("common.ok")),1)]),_:1},8,["loading","disabled"]),h[14]||(h[14]=w("br",null,null,-1)),h[15]||(h[15]=O()),h[16]||(h[16]=w("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:Y.value,readonly:!0},null,8,["value"]),[[Z,Y.value]])]),default:a(()=>[l(nl,{inline:!0,"label-width":"90px",size:"small"},{default:a(()=>[l(re,null,{label:a(()=>[l(Ke),O(x(o(d)("common.name")),1)]),default:a(()=>[l($e,{modelValue:p.name,"onUpdate:modelValue":h[0]||(h[0]=b=>p.name=b),size:"small",fixed:""},null,8,["modelValue"])]),_:1}),U.value?(m(),D(re,{key:0,label:"ZEROFILL"},{default:a(()=>[l(oe,{modelValue:p.zerofill,"onUpdate:modelValue":h[1]||(h[1]=b=>p.zerofill=b),"true-value":"1","false-value":"0"},null,8,["modelValue"])]),_:1})):L("",!0),S.value?(m(),D(re,{key:1,label:"CURRENT_TIMESTAMP","label-width":"160px"},{default:a(()=>[l(oe,{modelValue:p.useCurrentTimestamp,"onUpdate:modelValue":h[2]||(h[2]=b=>p.useCurrentTimestamp=b),onChange:te},null,8,["modelValue"])]),_:1})):L("",!0),h[13]||(h[13]=w("br",null,null,-1)),l(re,null,{label:a(()=>[l(Ke),O(x(o(d)("common.type")),1)]),default:a(()=>[l(tl,{visible:c.visible,"onUpdate:visible":h[6]||(h[6]=b=>c.visible=b),placement:"bottom-start","popper-class":"!p-0",trigger:"click",tabindex:null},{reference:a(()=>[l($e,{modelValue:p.type,"onUpdate:modelValue":h[3]||(h[3]=b=>p.type=b),size:"small",fixed:"",onKeyup:Ce(H,["enter"]),onInput:h[4]||(h[4]=b=>{c.inputting=!0,c.visible=!0}),onClick:h[5]||(h[5]=b=>c.inputting=!1)},null,8,["modelValue"])]),default:a(()=>[w("div",Vl,[(m(!0),k(J,null,ae(G.value,(b,le)=>(m(),k(J,null,[b=="hr"?(m(),k("div",{key:le,class:"w-full type-hr bg-bg"})):(m(),k("div",{key:1,class:"el-select-dropdown__item !h-6 min-w-[190px] bg-[var(--vscode-dropdown-background)]",onClick:W=>{p.type=b.value||b,c.visible=!1}},x(b.label||b),9,Sl))],64))),256))])]),_:1},8,["visible"])]),_:1}),Q("ClickHouse")?(m(),D(re,{key:2,label:o(d)("design.isNotNull")},{default:a(()=>[l(oe,{modelValue:p.isNotNull,"onUpdate:modelValue":h[7]||(h[7]=b=>p.isNotNull=b)},null,8,["modelValue"])]),_:1},8,["label"])):L("",!0),U.value?(m(),D(re,{key:3,label:"UNSIGNED"},{default:a(()=>[l(oe,{modelValue:p.unsigned,"onUpdate:modelValue":h[8]||(h[8]=b=>p.unsigned=b),"true-value":"1","false-value":"0"},null,8,["modelValue"])]),_:1})):L("",!0),!["Snowflake"].includes(o(t))||v.isNew?(m(),D(re,{key:4,label:o(d)("common.default")},{default:a(()=>[l($e,{modelValue:p.defaultValue,"onUpdate:modelValue":h[9]||(h[9]=b=>p.defaultValue=b),size:"small",fixed:""},null,8,["modelValue"])]),_:1},8,["label"])):L("",!0),["DuckDB"].includes(o(t))?L("",!0):(m(),D(re,{key:5,label:o(d)("common.comment")},{default:a(()=>[l($e,{modelValue:p.comment,"onUpdate:modelValue":h[10]||(h[10]=b=>p.comment=b),size:"small",fixed:""},null,8,["modelValue"])]),_:1},8,["label"]))]),_:1})]),_:1},8,["modelValue","title"])])}}}),Bl=Ze(Ml,[["__scopeId","data-v-ab428a54"]]),Fl={class:"ml-4"},Pl={class:"flex flex-col gap-y-2"},Kl={class:"flex-wrap"},Hl={class:"inline-block mr-5"},zl={class:"font-bold mr-5 inline-block"},Gl={class:"inline-block mr-5"},ql={class:"font-bold mr-5 inline-block"},Ql={class:"flex-wrap"},Yl={key:0,class:"inline-block mr-5"},Xl={class:"font-bold mr-5 inline-block"},jl={key:1,class:"inline-block mr-5"},Wl={class:"font-bold mr-5 inline-block"},Zl={class:"inline-block pt-1"},Jl=se({__name:"InfoPanel",setup(s){const e=me(),{dialect:t}=ge(e),n=B([]),i=ee({name:null,schema:null,newTableName:null,comment:null,newComment:null,collation:null,newCollation:null});ce(()=>{$.on("designMetaNext",r=>{i.name=r.table,i.schema=r.schema,i.newTableName=r.table,i.comment=r.comment,i.newComment=r.comment,i.collation=r.collation,i.newCollation=r.collation}).on("collations",r=>{n.value=r})});const u=()=>{const r={...i,table:i.name};$.emit("updateTable",r);const g=t.value.updateTable(r);g?$.emit("execute",{type:"table",sql:g}):Oe("No any change!")};return(r,g)=>{const c=Ne,E=Be,_=Me,A=K("vsc-button");return m(),k("div",Fl,[w("div",Pl,[w("div",Kl,[w("div",Hl,[w("label",zl,x(r.$t("design.table")),1),l(c,{modelValue:i.newTableName,"onUpdate:modelValue":g[0]||(g[0]=f=>i.newTableName=f),class:"!w-48",required:"",onKeyup:Ce(u,["enter"])},null,8,["modelValue"])]),w("div",Gl,[w("label",ql,x(r.$t("common.comment")),1),l(c,{modelValue:i.newComment,"onUpdate:modelValue":g[1]||(g[1]=f=>i.newComment=f),class:"!w-48",onKeyup:Ce(u,["enter"])},null,8,["modelValue"])])]),w("div",Ql,[o(e).tableMeta.engine?(m(),k("div",Yl,[w("label",Xl,x(r.$t("design.engine")),1),l(c,{value:o(e).tableMeta.engine,class:"!w-24",disabled:""},null,8,["value"])])):L("",!0),i.collation&&n.value.length>0?(m(),k("div",jl,[w("label",Wl,x(r.$t("design.collate")),1),l(_,{modelValue:i.newCollation,"onUpdate:modelValue":g[2]||(g[2]=f=>i.newCollation=f),size:"small",filterable:"",class:"w-44"},{default:a(()=>[(m(!0),k(J,null,ae(n.value,f=>(m(),D(E,{key:f.name,label:f.name,value:f.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):L("",!0),w("div",Zl,[l(A,{type:"success",onClick:u},{default:a(()=>[O(x(r.$t("common.update")),1)]),_:1})])])])])}}}),et={key:0,class:"design-toolbar"},lt={class:"text-center"},tt=se({__name:"Check",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:i,activePanel:u}=ge(e),r=B([]),g=B(!0),c=ee({visible:!1,loading:!1}),E=ee({clause:null}),_=F(()=>E.clause?t.value.newCheck(E.clause):"");ce(()=>{$.on("designMetaNext",p=>{p.isSupportCheck&&(A(),c.visible=!1)}).on("checks",p=>{g.value=!1,r.value=p}).on("success",p=>{p=="check"&&(A(),c.visible=!1,c.loading=!1)}).on("error",()=>{c.loading=!1})});const A=()=>{const p=t.value.showChecks();if(!p){console.log("This database type does not currently support check."),g.value=!1;return}g.value=!0,$.emit("checks",p)},f=()=>{c.visible=!0,c.loading=!1,E.clause=null},T=()=>{c.loading=!0,$.emit("execute",{type:"check",sql:_.value})},I=p=>{Ue(d("design.deleteCheckConfirm")).then(()=>{$.emit("execute",{type:"check",sql:t.value.dropCheck(p.name)})})};return(p,v)=>{const U=K("vsc-button"),S=K("vsc-tooltip"),z=we,V=Ie,y=K("RedMark"),G=Ne,Y=De,q=Le,Q=Ae,te=he;return m(),k("div",null,[o(n)?(m(),k("div",et,[l(S,{title:o(d)("common.new")},{default:a(()=>[l(U,{type:"icon",icon:"codicon-add text-base",onClick:f})]),_:1},8,["title"]),l(S,{title:o(d)("common.refresh")},{default:a(()=>[l(U,{type:"icon",icon:"codicon-refresh text-base",onClick:A})]),_:1},8,["title"])])):L("",!0),o(u)=="check"?P((m(),D(V,{key:1,data:r.value,height:o(i),border:""},{default:a(()=>[o(n)?(m(),D(z,{key:0,resizable:!0,align:"center",prop:"name",label:o(d)("design.constraintName"),width:"200"},null,8,["label"])):L("",!0),l(z,{resizable:!0,align:"center",prop:"clause",label:o(d)("design.clause"),width:"200"},null,8,["label"]),o(n)?(m(),D(z,{key:1,label:o(d)("design.operation"),width:"100"},{default:a(({row:H})=>[w("div",lt,[l(U,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:X=>I(H)},null,8,["onClick"])])]),_:1},8,["label"])):L("",!0)]),_:1},8,["data","height"])),[[te,g.value]]):L("",!0),l(Q,{modelValue:c.visible,"onUpdate:modelValue":v[3]||(v[3]=H=>c.visible=H),"show-close":!1,title:o(d)("design.newCheck"),width:"430px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(U,{type:"secondary",onClick:v[2]||(v[2]=H=>c.visible=!1)},{default:a(()=>[O(x(o(d)("common.cancel")),1)]),_:1}),l(U,{type:"primary",loading:c.loading,onClick:T},{default:a(()=>[O(x(o(d)("common.ok")),1)]),_:1},8,["loading"]),v[4]||(v[4]=w("br",null,null,-1)),v[5]||(v[5]=O()),v[6]||(v[6]=w("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:_.value,readonly:!0},null,8,["value"]),[[Z,_.value]])]),default:a(()=>[l(q,{inline:!0,"label-width":"80px","label-position":"left",onSubmit:v[1]||(v[1]=Je(()=>{},["prevent"])),onKeyup:Ce(T,["enter"])},{default:a(()=>[l(Y,null,{label:a(()=>[l(y),O(x(o(d)("design.clause")),1)]),default:a(()=>[l(G,{modelValue:E.clause,"onUpdate:modelValue":v[0]||(v[0]=H=>E.clause=H),class:"!w-[290px]",size:"small",placeholder:"e.g. id >20 and name!='admin'"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),nt={key:0,class:"design-toolbar"},ot=se({__name:"Trigger",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:i,activePanel:u}=ge(e),r=B([]),g=B(!0),c=ee({visible:!1,loading:!1}),E=ee({clause:null}),_=F(()=>"");ce(()=>{$.on("designMetaNext",()=>{A(),c.visible=!1}).on("triggers",T=>{g.value=!1,r.value=T}).on("success",T=>{T=="trigger"&&(A(),c.visible=!1,c.loading=!1)}).on("error",()=>{c.loading=!1})});const A=()=>{g.value=!0,$.emit("triggers")},f=()=>{c.loading=!0,$.emit("execute",{type:"trigger",sql:_.value})};return(T,I)=>{const p=K("vsc-button"),v=K("vsc-tooltip"),U=we,S=Ie,z=K("RedMark"),V=Ne,y=De,G=Le,Y=Ae,q=he;return m(),k("div",null,[o(n)?(m(),k("div",nt,[l(v,{title:o(d)("common.refresh")},{default:a(()=>[l(p,{type:"icon",icon:"codicon-refresh text-base",onClick:A})]),_:1},8,["title"])])):L("",!0),o(u)=="trigger"?P((m(),D(S,{key:1,data:r.value,height:o(i),border:""},{default:a(()=>[l(U,{resizable:!0,align:"center",prop:"trigger_name",label:o(d)("design.triggerName"),width:"200"},null,8,["label"]),l(U,{resizable:!0,align:"center",prop:"timing",label:o(d)("design.timing"),width:"200"},null,8,["label"]),l(U,{resizable:!0,align:"center",prop:"manipulation",label:o(d)("design.manipulation"),width:"200"},null,8,["label"]),l(U,{resizable:!0,align:"center",prop:"orientation",label:o(d)("design.orientation"),width:"200"},null,8,["label"]),l(U,{resizable:!0,align:"center",prop:"statement",label:o(d)("design.statement"),width:"200"},{default:a(Q=>[O(x(Q.row.source||Q.row.statement),1)]),_:1},8,["label"])]),_:1},8,["data","height"])),[[q,g.value]]):L("",!0),l(Y,{modelValue:c.visible,"onUpdate:modelValue":I[3]||(I[3]=Q=>c.visible=Q),"show-close":!1,title:o(d)("design.newTrigger"),width:"430px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(p,{type:"secondary",onClick:I[2]||(I[2]=Q=>c.visible=!1)},{default:a(()=>[O(x(o(d)("common.cancel")),1)]),_:1}),l(p,{type:"primary",loading:c.loading,onClick:f},{default:a(()=>[O(x(o(d)("common.ok")),1)]),_:1},8,["loading"]),I[4]||(I[4]=w("br",null,null,-1)),I[5]||(I[5]=O()),I[6]||(I[6]=w("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:_.value,readonly:!0},null,8,["value"]),[[Z,_.value]])]),default:a(()=>[l(G,{inline:!0,"label-width":"80px","label-position":"left",onSubmit:I[1]||(I[1]=Je(()=>{},["prevent"])),onKeyup:Ce(f,["enter"])},{default:a(()=>[l(y,null,{label:a(()=>[l(z),O(x(o(d)("design.clause")),1)]),default:a(()=>[l(V,{modelValue:E.clause,"onUpdate:modelValue":I[0]||(I[0]=Q=>E.clause=Q),class:"!w-[290px]",size:"small",placeholder:"e.g. AFTER INSERT ON table_name FOR EACH ROW"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});class ie{constructor(e){this.meta=e,this.dialect=vl(e.dbType),this.wrappedTable=ue(this.meta.table,this.meta.dbType,_l.Always)}updateTable(e){return this.dialect.updateTable(e)}columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","hr","BOOLEAN","FLOAT","DOUBLE","hr","TEXT","JSON","BLOB"]}strategies(){return["RESTRICT","CASCADE","SET NULL","SET DEFAULT","NO ACTION"]}newColumn(e){const{name:t,type:n,isNotNull:i}=e,u=i?" NOT NULL":"";return`ALTER TABLE ${this.wrappedTable} ADD COLUMN ${ue(t,this.meta.dbType)} ${n}${u}`}updateColumn(e){return this.dialect.updateColumnSql({...e,table:this.meta.table,tableMeta:this.meta,schema:this.meta.schema})}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP COLUMN ${ue(e,this.meta.dbType)}`}formatIndexType(e){return e.index_type}indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"}]}newIndex(e){return`ALTER TABLE ${this.wrappedTable} ADD INDEX (${e.columns.join(",")})`}dropIndex(e){return this.dialect.dropIndex(this.wrappedTable,e)}dropTrigger(e){return this.dialect.dropTriggerTemplate(e,this.wrappedTable)}showChecks(){return this.dialect.showChecks(this.meta.schema,this.meta.table)}showTriggers(){return this.dialect.showTriggers(this.meta.schema,this.meta.table)}showIndex(){return this.dialect.showIndex(this.meta.schema,this.meta.table)}showForeignKeys(){return this.dialect.showForeignKeys(this.meta.schema,this.meta.table)}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:i,refColumn:u,onUpdate:r,onDelete:g}=e,c=r=="NO ACTION"?"":` ON UPDATE ${r}`,E=g=="NO ACTION"?"":` ON DELETE ${g}`;return new de(`ALTER TABLE "${this.meta.table}"`).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,"ADD").append(`FOREIGN KEY ("${t}") REFERENCES "${i}"("${u}")${c}${E};`).toString()}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT ${e};`}newCheck(e){return`ALTER TABLE ${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE ${this.wrappedTable} DROP CONSTRAINT ${e};`}splitColumn(e,t='"'){return e.map(n=>t+n+t).join(",")}}class at extends ie{columnTypes(){return["Int32","String","Float32","hr","Date","DateTime","hr","BOOLEAN","UUID",{label:"Array",value:"Array(String)"},"hr","JSON",{label:"Tuple",value:"Tuple(String)"},{label:"Map",value:"Map(String,String)"},"hr","Int8","Int16","Int64","Int128","Int256","UInt8","UInt16","UInt32","UInt64","UInt128","UInt256","hr","DateTime64","DateTime32","hr","Decimal32","Decimal64","Decimal128","Decimal256","hr","IPv4","IPv6","hr",{label:"Enum8",value:"Enum8('a'=1)"},{label:"Enum16",value:"Enum16('a'=1)"},"hr",{label:"FixedString",value:"FixedString(100)"}]}newColumn(e){const{name:t,type:n,defaultValue:i,comment:u}=e;return new de(`ALTER TABLE ${this.wrappedTable} ADD COLUMN "${t}" ${n}`).if(!_e(i),`DEFAULT ${Te(i,n)}`).if(u,`COMMENT '${u}'`).toString()}newIndex(e){const{columns:t}=e;return`ALTER TABLE "${this.meta.table}" ADD INDEX ${t.join("")}_${new Date().getTime()}_index expression TYPE type GRANULARITY value AFTER ${this.splitColumn(t)}`}showForeignKeys(){return null}showChecks(){return null}}class Fe extends ie{newColumn(e){const{name:t,type:n,defaultValue:i,isNotNull:u}=e;return new de(`ALTER TABLE "${this.meta.schema}".${ue(this.meta.table,this.meta.dbType)} ADD ${ue(t,this.meta.dbType)} ${n}`).if(u,"NOT NULL").if(!_e(i),`DEFAULT ${Te(i,n)}`).toString()}dropColumn(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP COLUMN ${ue(e,this.meta.dbType)}`}newIndex(e){const{table:t=this.meta.table,columns:n,type:i}=e,u=`${t}_${n.join("_")}_${new Date().getTime()}`;return`CREATE ${i=="UNIQUE"?"UNIQUE":""} INDEX ${u} ON "${this.meta.schema}"."${t}"(${this.splitColumn(n)});`}newCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP CONSTRAINT ${e};`}dropForeignKey(e){return`ALTER TABLE "${this.meta.schema}"."${this.meta.table}" DROP CONSTRAINT ${e};`}newForeignKey(e){return super.newForeignKey(e).replace(`"${this.meta.table}"`,`"${this.meta.schema}"."${this.meta.table}"`)}}class st extends ie{indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"},{label:"FULLTEXT",value:"FULLTEXT"}]}columnTypes(){return["INT",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATETIME","TIMESTAMP","DATE","hr","BIT","FLOAT","DOUBLE",{label:"DECIMAL",value:"DECIMAL(10,2)"},"BIGINT","hr","TEXT","JSON","BLOB","BINARY","hr",{label:"ENUM",value:"ENUM('item')"},{label:"SET",value:"SET('item')"},"hr","TINYINT","SMALLINT","MEDIUMINT","hr","TIME","YEAR","hr","VARBINARY","TINYBLOB","MEDIUMBLOB","LONGBLOB","TINYTEXT","MEDIUMTEXT","LONGTEXT","hr","GEOMETRY","POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","GEOMETRYCOLLECTION"]}newColumn(e){const{name:t,type:n,comment:i,defaultValue:u,isNotNull:r,unsigned:g,zerofill:c}=e;return console.log(e),new de(`ALTER TABLE ${this.wrappedTable} ADD COLUMN \`${t}\` ${n}`).if(g&&g!=0,"UNSIGNED").if(c,"ZEROFILL").if(r,"NOT NULL").if(i,`COMMENT '${i}'`).if(!_e(u),`DEFAULT ${Te(u,n)}`).toString()}formatIndexType(e){const t=e.index_type.toUpperCase();return t=="BTREE"?e.index_name=="PRIMARY"?"PRIMARY":Se(e.isUnique)?"UNIQUE":"KEY":t}newIndex(e){const{type:t="key",columns:n}=e;return`ALTER TABLE \`${this.meta.table}\` ADD ${t} (${this.splitColumn(n,"`")})`}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:i,refColumn:u,onUpdate:r,onDelete:g}=e,c=r=="NO ACTION"?"":` ON UPDATE ${r}`,E=g=="NO ACTION"?"":` ON DELETE ${g}`;return new de(`ALTER TABLE \`${this.meta.table}\``).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,"ADD").append(`FOREIGN KEY (\`${t}\`) REFERENCES \`${i}\`(\`${u}\`)${c}${E};`).toString()}dropForeignKey(e){return`ALTER TABLE \`${this.meta.table}\` DROP FOREIGN KEY ${e};`}}class it extends ie{newIndex(e){const{table:t=this.meta.table,columns:n,type:i}=e,u=`${t}_${n.join("_")}_${new Date().getTime()}`;return`CREATE ${i=="UNIQUE"?"UNIQUE":""} INDEX ${u} ON "${t}"(${this.splitColumn(n)})`}newColumn(e){const{name:t,type:n,isNotNull:i,defaultValue:u,comment:r}=e;return new de(`ALTER TABLE ${ue(this.meta.table,this.meta.dbType)} ADD ${t} ${n}`).if(!_e(u),`DEFAULT ${Te(u,n)}`).if(i,"NOT NULL").if(r,`;
COMMENT ON COLUMN ${this.wrappedTable}."${t.toUpperCase()}" is '${r}';`).toString()}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:i,refColumn:u,onUpdate:r,onDelete:g}=e,c=r=="NO ACTION"?"":` ON UPDATE ${r}`,E=g=="NO ACTION"?"":` ON DELETE ${g}`,_=n||`${t}_${i}_${u}_fk_${Math.floor(Math.random()*30)}`;return`ALTER TABLE "${this.meta.table}" ADD CONSTRAINT ${_} FOREIGN KEY ("${t}") REFERENCES ${i}(${u})${c}${E};`}showForeignKeys(){let{schema:e}=this.meta;return e?.toLowerCase()==this.meta.user?.toLowerCase()&&(e=void 0),this.dialect.showForeignKeys(e,this.meta.table)}columnTypes(){return["INTEGER",{label:"VARCHAR2",value:"VARCHAR2(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","hr","NUMBER","FLOAT","hr","CLOB","BLOB","hr","BINARY_FLOAT","BINARY_DOUBLE","hr","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","hr","INTERVAL YEAR TO MONTH","INTERVAL DAY TO SECOND","hr","RAW","LONG RAW","LONG","hr","NCHAR","NVARCHAR2","NCLOB","hr","BFILE","ROWID","UROWID"]}}class rt extends ie{newColumn(e){const{name:t,type:n,comment:i,defaultValue:u,isNotNull:r}=e,g=this.wrappedTable;return new de(`ALTER TABLE ${g} ADD COLUMN "${t}" ${n}`).if(r,"NOT NULL").if(!_e(u),`DEFAULT ${Te(u,n)}`).append(";").if(i,`
COMMENT ON COLUMN ${g}."${t}" is '${i}';`).toString()}columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"TIMESTAMP","DATE","BOOLEAN","FLOAT","TEXT","JSON","BLOB","hr","SMALLINT","BIGINT","REAL","DOUBLE PRECISION","hr","BYTEA","XML","UUID","ARRAY","hr","NUMERIC","MONEY","INTERVAL","CIDR","INET","MACADDR"]}indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"},{label:"HASH",value:"HASH"}]}newIndex(e){const{table:t=this.meta.table,columns:n,type:i}=e,u=i=="HASH"?"hash":"btree";return`CREATE ${i=="UNIQUE"?"UNIQUE":""} INDEX ${n.join("_")}_${new Date().getTime()}_index ON "${t}" USING ${u} (${this.splitColumn(n)});`}}class ut extends ie{newIndex(e){throw new Error("Method not implemented.")}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT "${e}";`}showForeignKeys(){return`select
       rco.constraint_name "constraint_name",
       rco.UPDATE_RULE "updateRule",
       rco.DELETE_RULE "deleteRule",
       pk_tco.table_name "referenced_table"
from information_schema.referential_constraints rco
    join information_schema.table_constraints fk_tco on fk_tco.constraint_name = rco.constraint_name and fk_tco.constraint_schema = rco.constraint_schema
    join information_schema.table_constraints pk_tco on pk_tco.constraint_name = rco.unique_constraint_name and pk_tco.constraint_schema = rco.unique_constraint_schema
    WHERE fk_tco.TABLE_SCHEMA='${this.meta.schema}' and fk_tco.table_name='${this.meta.table}' 
    ORDER BY rco.CREATED`}}class dt extends ie{newIndex(e){const{table:t=this.meta.table,columns:n}=e;return`CREATE INDEX ${`${t}_${n.join("_")}_${new Date().getTime()}`} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT "from" column_name, "table" referenced_table, "to" referenced_column,
        on_update, on_delete 
        FROM pragma_foreign_key_list('${this.meta.table}');`}showChecks(){return null}}class ct extends ie{newColumn(e){const{type:t,defaultValue:n}=e;return new de(super.newColumn(e)).if(!_e(n),`DEFAULT ${Te(n,t)}`).toString()}newIndex(e){const{table:t=this.meta.table,columns:n}=e;return`CREATE INDEX ${`${t}_${n.join("_")}_${new Date().getTime()}`} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT constraint_column_names "column_name" FROM duckdb_constraints()
        WHERE constraint_type='FOREIGN KEY' and database_name not in ('system','temp') and schema_name='${this.meta.schema}' and table_name='${this.meta.table}'`}showChecks(){return null}}class mt extends Fe{columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","TIME","hr","BOOLEAN","FLOAT","DOUBLE","hr","TEXT","BLOB","hr","SMALLINT","BIGINT","DECFLOAT","hr","TIMESTAMP WITH TIME ZONE","TIME WITH TIME ZONE","hr","XML","GRAPHIC","VARGRAPHIC","hr","DBCLOB","CLOB"]}}class pt extends Fe{columnTypes(){return["INTEGER","TEXT","hr","DATE","TIMESTAMP","hr","BOOLEAN","FLOAT","DOUBLE","hr","BLOB","hr","BIGINT","SMALLINT","TINYINT","VARINT","hr","TIME","TIMEUUID","hr","DECIMAL","COUNTER","hr","UUID","INET","ASCII","DURATION"]}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP ${ue(e,this.meta.dbType)}`}}function bt(s){switch(s.dbType){case R.PG:case R.REDSHIFT:case R.KINGBASE:case R.GAUSS_DB:case R.COCKROACH:return new rt(s);case R.DM:case R.ORACLE:return new it(s);case R.DB2:return new mt(s);case R.CASSANDRA:return new pt(s);case R.SQLServer:return new Fe(s);case R.SNOWFLAKE:return new ut(s);case R.CLICKHOUSE:return new at(s);case R.DUCK_DB:return new ct(s);case R.D1:case R.libSQL:case R.SQLITE:return new dt(s);case R.MYSQL:case R.MARIA_DB:case R.DATABRICKS:return new st(s);default:return new ie(s)}}const ft={class:"mt-2 design-container"},gt={id:"infoPanel"},vt={class:"tab"},_t=["onClick"],Tt={class:"design-data-container"},ht=se({__name:"design",setup(s){const e=B(!1),t=me(),n=F(()=>t.activePanel),i=F(()=>[{id:"ddl",i18n:"design.ddl",icon:"codicon-edit green"},{id:"column",i18n:"design.column",icon:"codicon-symbol-field blue"},{id:"foreignKey",i18n:"design.foreignKey",icon:"codicon-symbol-class yellow",hidden:F(()=>!t.supportForeignKey)},{id:"index",i18n:"design.index",icon:"codicon-github-action purple",hidden:F(()=>!t.supportIndex)},{id:"trigger",i18n:"design.trigger",icon:"codicon-github-action orange",hidden:F(()=>!t.supportTrigger)},{id:"check",i18n:"design.check",icon:"codicon-tools red",hidden:F(()=>!t.supportCheck||!e.value)}].filter(r=>r?.hidden?.value!=!0));ce(()=>{$.on("dbType",r=>{t.updateDBType(r)}).on("designMeta",r=>{e.value=r.isSupportCheck,t.dialect=bt(r),t.updateFullInfo(r),$.emitImmediately("designMetaNext",r)}).on("success",()=>{We(d("design.updateSuccess"))}).on("error",r=>{Oe(r)}).on("refresh_design",()=>{u()}),u(),Tl(55,["tableTab","infoPanel"],r=>{t.remainHeight=r})});const u=()=>{$.emit("init",{type:"design"})};return(r,g)=>(m(),k("div",ft,[w("div",gt,[l(Jl),w("ul",vt,[(m(!0),k(J,null,ae(i.value,(c,E)=>(m(),k("li",{key:E,class:ze(["tab__item",{"tab__item--active":n.value==c.id}]),onClick:_=>o(t).activePanel=c.id},[c.icon?(m(),k("i",{key:0,type:"icon",class:ze(c.icon),style:{position:"relative",top:"3px"}},null,2)):L("",!0),O(" "+x(o(d)(c.i18n)),1)],10,_t))),128))])]),w("div",Tt,[P(l(Dl,null,null,512),[[Z,n.value=="ddl"]]),P(l(Bl,null,null,512),[[Z,n.value=="column"]]),P(l(kl,null,null,512),[[Z,n.value=="foreignKey"]]),P(l(wl,null,null,512),[[Z,n.value=="index"]]),P(l(ot,null,null,512),[[Z,n.value=="trigger"]]),P(l(tt,null,null,512),[[Z,n.value=="check"]])])]))}}),jt=Ze(ht,[["__scopeId","data-v-68f3d12d"]]);export{jt as default};
